version: "3.9"

services:
  frontend-server:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        APP_NAME: frontend-server
    container_name: sentiment-analyzer-frontend
    ports: ["80:8080"]
    environment: 
      PORT: 8080
      ANALYZER_URL: http://data-analyzer:8080
      COLLECTOR_URL: http://data-collector:8080   
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  data-analyzer:
    build:
      args:
        APP_NAME: data-analyzer-server
    container_name: sentiment-analyzer
    ports: ["8883:8080"]
    environment:  
      PORT: 8080
      SELF_URL: http://data-analyzer:8080
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

  data-collector:
    build:
      args:
        APP_NAME: data-collector-server
    container_name: sentiment-data-collector
    ports: ["8882:8080"]
    environment: 
      PORT: 8080
      ANALYZER_URL: http://data-analyzer:8080
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s      